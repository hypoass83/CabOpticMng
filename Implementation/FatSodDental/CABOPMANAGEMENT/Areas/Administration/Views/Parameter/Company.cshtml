@using FatSod.Ressources;
@model FatSod.Security.Entities.Company
@{
    ViewBag.Title = Resources.CompanyAndJob;
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="box box-primary box-body">
    <!--<form id="FormAccountingSection">-->
    @****************************@
    @Html.AntiForgeryToken()

    <h6>@Resources.RequireField<code>(*)</code>.</h6>
    <hr>

    <div class="row">
        <!-- Left Side Begins Here -->
        <!--<div id="right_field" class="col-md-4">-->
        <fieldset class="col-md-4">
            <!-- Company Name -->
            <div class="row ipt">
                <input class="form-control input-sm" id="GlobalPersonID" name="GlobalPersonID" type="hidden" value="@ViewBag.Company.GlobalPersonID">
                <input class="form-control input-sm" id="Code" name="Code" type="hidden" value="@ViewBag.Company.CNI+@ViewBag.Company.CompanySigle">
                <input class="form-control input-sm" id="ONOCNumber" name="ONOCNumber" type="hidden" value="@ViewBag.Company.ONOCNumber">
            </div>
            <div class="row ipt">
                <div class="col-sm-4">@Resources.PersonName<code>(*)</code></div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="Name" id="Name" value="@ViewBag.Company.Name">
                </div>
            </div>
            <!-- Company Capital -->
            <div class="row ipt">
                <div class="col-sm-4">Capital<code>(*)</code></div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="CompanyCapital" id="CompanyCapital" value="@ViewBag.Company.CompanyCapital">
                </div>
            </div>
            <!-- Company Tax ID -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.NumeroContribuable<code>(*)</code></div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="CNI" id="CNI" value="@ViewBag.Company.CNI">
                </div>
            </div>
            <!-- Company Trade Register -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.TradeRegister<code>(*)</code></div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="CompanyTradeRegister" id="CompanyTradeRegister" value="@ViewBag.Company.CompanyTradeRegister">
                </div>
            </div>
            <!-- Company Abbreviation -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.Sigle</div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="CompanySigle" id="CompanySigle" value="@ViewBag.Company.CompanySigle">
                </div>
            </div>
            <!-- Company Slogan -->
            <div class="row ipt">
                <div class="col-sm-4">Slogan</div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="CompanySlogan" id="CompanySlogan" value="@ViewBag.Company.CompanySlogan">
                </div>
            </div>
            <!-- Company Distribution -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.Description<code>(*)</code></div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="Description" id="Description" value="@ViewBag.Company.Description">
                </div>
            </div>
        </fieldset>
        <!--</div>-->
        <!-- Middle Side Begins Here -->
        <!--<div id="left_field" class="col-md-4">-->
        <fieldset class="col-md-4" style="border-left: 2px solid black">
            <div class="row ipt">
                <input class="form-control input-sm" id="AdressID" name="AdressID" type="hidden" value="@ViewBag.Company.AdressID">
            </div>
            <!-- Mobile Select -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.PersonMobile<code>(*)</code></div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="AdressPhoneNumber" id="AdressPhoneNumber" value="@ViewBag.Company.Adress.AdressPhoneNumber">
                </div>
            </div>

            <!-- Region Input -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.AdressCellNumber</div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="AdressCellNumber" id="AdressCellNumber" value="@ViewBag.Company.Adress.AdressCellNumber">
                </div>
            </div>

            <!-- Email Input -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.AdressEmail</div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="AdressEmail" id="AdressEmail" value="@ViewBag.Company.Adress.AdressEmail">
                </div>
            </div>

            <!-- PO Box Input -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.PersonBox</div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="AdressPOBox" id="AdressPOBox" value="@ViewBag.Company.Adress.AdressPOBox">
                </div>
            </div>

            <!-- Complete Adress -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.AdressFullName<code>(*)</code></div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="AdressFullName" id="AdressFullName" value="@ViewBag.Company.Adress.AdressFullName">
                </div>
            </div>

            <!-- Fax -->
            <div class="row ipt">
                <div class="col-sm-4">Fax</div>
                <div class="col-sm-8">
                    <input class="form-control input-sm" type="text" name="AdressFax" id="AdressFax" value="@ViewBag.Company.Adress.AdressFax">
                </div>
            </div>

            <!-- Country Select -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.AdressCountry<code>(*)</code></div>
                <div class="col-sm-8">
                    <select id="Country" name="Country" class="form-control" ></select>
                </div>
            </div>

            <!-- Region Select -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.AdressRegion<code>(*)</code></div>
                <div class="col-sm-8">
                    <select id="Region" name="Region" class="form-control"></select>
                </div>
            </div>

            <!-- Town Select -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.AdressTown<code>(*)</code></div>
                <div class="col-sm-8">
                    <select id="Town" name="Town" class="form-control"></select>
                </div>
            </div>

            <!-- Quarter Select -->
            <div class="row ipt">
                <div class="col-sm-4">@Resources.AdressQuarter<code>(*)</code></div>
                <div class="col-sm-8">
                    <select id="Quarter" name="QuarterID" class="form-control"></select>
                </div>
            </div>

        </fieldset>
        <!-- </div>-->
        <!-- Right Side Begins Here -->

        <fieldset class="col-md-3">
            <legend>Company Image </legend>
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row">
                        <input class="form-control input-sm" type="hidden" name="FileID" id="FileID" value="0" >
                        <div class="form-group" style="padding: 10px;">
                            <label>Upload Image</label>
                            <div class="input-group">
                                <span class="input-group-btn">
                                    <span class="btn btn-default btn-file">
                                        Browse… <input type="file" name="UploadImage" id="UploadImage">
                                    </span>
                                </span>
                                <input type="text" class="form-control" readonly>
                            </div>
                            <img id='img-upload' src="~/User/File?id=@ViewBag.CompanyLogoID" style="height:200px; width:200px;" />
                        </div>
                    </div>
                </div>
            </div>
        </fieldset>
        <div class="col-sm-1"></div>
    </div><br />
    <div class="row">
        @*<div class="col-sm-2">
            <button id="btnCancel" class="btn btn-primary">@Resources.ResetButton</button>
        </div>*@
        <div class="col-sm-12" style="text-align:center;">
            <button id="btnSubmit" class="btn btn-primary btn-success">@Resources.SaveButton</button>
        </div>
    </div>
</div>
   


<!--********** JavaScripts **********-->
<script>

    function initialiseCombo() {
        var companyID = $('#GlobalPersonID').val();
        $.get('@Url.Action("InitInfo", "Parameter")', { companyID: parseInt(companyID) }, function (data) {
            $.each(data, function (key, value) {
                $('#Country').val(value.Country);
                $('#Region').val(value.Region);
                $('#Town').val(value.Town);
                $('#Quarter').val(value.QuarterID);
            });
        }, 'json');
    }
    // Get the Country List
    function populateCountry() {
        $.get('@Url.Action("populateCountry", "Parameter")', {}, function (data) {
            $('#Country').empty();
            $('#Country').append($("<option value='0'>@Resources.Select</option>"));
            $.each(data, function (key, value) {
                $('#Country').append($("<option></option>").val(value.ID).html(value.Name));
            });
        }, 'json');
    }

    // Get the Region List for the selected Country
    function populateRegion() {

        $('#Region').append($("<option value='0'>@Resources.Select</option>"));

        $('#Country').change(function () {

            var _countryId = $('#Country').val();

            if ($('#Country').val() == 0) {
                $('#Region').prop('selectedIndex', 0);
                $('#Town').prop('selectedIndex', 0);
                $('#Quarter').prop('selectedIndex', 0);
            } else {
                $.get('@Url.Action("populateRegion", "Parameter")', { countryId: _countryId }, function (data) {
                    $('#Region').empty();
                    $('#Region').append($("<option value='0'>@Resources.Select</option>"));
                    $.each(data, function (key, value) {
                        $('#Region').append($("<option></option>").val(value.ID).html(value.Name));
                    });
                }, 'json');

            }
        });
    }

    // Get the Town List for the selected Region
    function populateTown() {

        $('#Town').append($("<option value='0'>@Resources.Select</option>"));

        $('#Region').change(function () {

            var _regionId = $('#Region').val();

            if ($('#Region').val() == 0) {
                        $('#Town').prop('selectedIndex', 0);
                        $('#Quarter').prop('selectedIndex', 0);
            } else {
                if ($('#Region').val() == 0) {
                    $('#Town').prop('selectedIndex', 0);
                    $('#Quarter').prop('selectedIndex', 0);
                } else {
                    $.get('@Url.Action("populateTown", "Parameter")', { regionId: _regionId }, function (data) {
                        $('#Town').empty();
                        $('#Town').append($("<option value='0'>@Resources.Select</option>"));
                        $.each(data, function (key, value) {
                            $('#Town').append($("<option></option>").val(value.ID).html(value.Name));
                        });
                    }, 'json');
                }
            }
        });
    }


    // Get the Quarter List for the selected Town
    function populateQuarterList() {
        $('#Quarter').append($("<option value='0'>@Resources.Select</option>"));
        $('#Town').change(function () {

            var _townId = $('#Town').val();

            if ($('#Town').val() == 0) {
                $('#Quarter').prop('selectedIndex', 0);

            } else {
                    $.get('@Url.Action("populateQuarterList", "Parameter")', { townId: _townId }, function (data) {
                        $('#Quarter').empty();
                        $('#Quarter').append($("<option value='0'>@Resources.Select</option>"));
                        $.each(data, function (key, value) {
                            $('#Quarter').append($("<option></option>").val(value.ID).html(value.Name));
                        });
                    }, 'json');
            }
        });
    }

    function clearForm() {
        $('#Name').val('');
        $('#CompanyCapital').val('');
        $('#CNI').val('');
        $('#CompanyTradeRegister').val('');
        $('#CompanySigle').val('');

        $('#CompanySlogan').val('');
        $('#Description').val('');
        $('#AdressPhoneNumber').val('');
        $('#AdressCellNumber').val('');
        $('#AdressEmail').val('');

        $('#AdressPOBox').val('');
        $('#AdressFullName').val('');
        $('#AdressFax').val('');

        $('#Country').val('');
        $('#Region').val('');
        $('#Town').val('');
        $('#Quarter').val('');
        $('#GlobalPersonID').val('');
    }


    $(document).on('ready', function () {
        populateCountry();
        populateRegion();
        populateTown();
        populateQuarterList();

        $('#btnCancel').on('click', function () {
            clearForm();
        });

        initialiseCombo();

        $('#btnSubmit').on('click', function () {
            var isAllValid = true;

            if ($('#Name').val().trim() == '') {
                isAllValid = false;
                $('#Name').addClass("invalid-data");
            }
            else {
                $('#Name').addClass("valid-data");
            }
            if ($('#CompanyCapital').val().trim() == '') {
                isAllValid = false;
                $('#CompanyCapital').addClass("invalid-data");
            }
            else {
                $('#CompanyCapital').addClass("valid-data");
            }
            if ($('#CNI').val().trim() == '') {
                isAllValid = false;
                $('#CNI').addClass("invalid-data");
            }
            else {
                $('#CNI').addClass("valid-data");
            }
            if ($('#CompanyTradeRegister').val().trim() == '') {
                isAllValid = false;
                $('#CompanyTradeRegister').addClass("invalid-data");
            }
            else {
                $('#CompanyTradeRegister').addClass("valid-data");
            }

            if ($('#Description').val().trim() == '') {
                isAllValid = false;
                $('#Description').addClass("invalid-data");
            }
            else {
                $('#Description').addClass("valid-data");
            }
            if ($('#AdressPhoneNumber').val().trim() == '') {
                isAllValid = false;
                $('#AdressPhoneNumber').addClass("invalid-data");
            }
            else {
                $('#AdressPhoneNumber').addClass("valid-data");
            }
            if ($('#AdressEmail').val().trim() == '') {
                isAllValid = false;
                $('#AdressEmail').addClass("invalid-data");
            }
            else {
                $('#AdressEmail').addClass("valid-data");
            }
            if ($('#AdressFullName').val().trim() == '') {
                isAllValid = false;
                $('#AdressFullName').addClass("invalid-data");
            }
            else {
                $('#AdressFullName').addClass("valid-data");
            }
            if ($('#Country').val() == "0") {
                isAllValid = false;
                $('#Country').addClass("invalid-data");
            }
            else {
                $('#Country').addClass("valid-data");
            }
            if ($('#Region').val() == "0") {
                isAllValid = false;
                $('#Region').addClass("invalid-data");
            }
            else {
                $('#Region').addClass("valid-data");
            }
            if ($('#Town').val() == "0") {
                isAllValid = false;
                $('#Town').addClass("invalid-data");
            }
            else {
                $('#Town').addClass("valid-data");
            }
            if ($('#Quarter').val() == "0") {
                isAllValid = false;
                $('#Quarter').addClass("invalid-data");
            }
            else {
                $('#Quarter').addClass("valid-data");
            }
            if (isAllValid) {

                var formData = new FormData();
                var totalFiles = document.getElementById("UploadImage").files.length;
                var file = document.getElementById("UploadImage").files[0];

                formData.append("UploadImage", file);
               
                formData.append("GlobalPersonID", $('#GlobalPersonID').val().trim());
                formData.append("Name", $('#Name').val().trim());
                formData.append("CompanyCapital", $('#CompanyCapital').val().trim());
                formData.append("Code", $('#Code').val().trim());
                formData.append("CNI", $('#CNI').val().trim());
                formData.append("CompanyTradeRegister", $('#CompanyTradeRegister').val().trim());
                formData.append("CompanySigle", $('#CompanySigle').val().trim());
                formData.append("CompanySlogan", $('#CompanySlogan').val().trim());
                formData.append("Description", $('#Description').val().trim());
                formData.append("AdressID", $('#AdressID').val().trim());
                formData.append("AdressPhoneNumber", $('#AdressPhoneNumber').val().trim());
                formData.append("AdressCellNumber", $('#AdressCellNumber').val().trim());
                formData.append("AdressEmail", $('#AdressEmail').val().trim());
                formData.append("AdressPOBox", $('#AdressPOBox').val().trim());
                formData.append("AdressFullName", $('#AdressFullName').val().trim());
                formData.append("AdressFax", $('#AdressFax').val().trim());
                formData.append("Country", $('#Country').val().trim());
                formData.append("Region", $('#Region').val().trim());
                formData.append("Town", $('#Town').val().trim());
                formData.append("QuarterID", $('#Quarter').val().trim());
                formData.append("FileID", $('#FileID').val().trim());
                formData.append("ONOCNumber", $('#ONOCNumber').val().trim());


                $(this).val('Please wait...');

                //post data to server
                $.ajax({
                    url: '@Url.Action("AddCompany", "Parameter")',
                    type: "POST",
                    data: formData, 
                    dataType: "JSON",
                    contentType: false,
                    processData: false,
                    success: function (d) {
                        //check is successfully save to database
                        if (d.status == true) {
                            //will send status from server side
                            alert(d.Message);
                            location.reload(true);
                            //clear form
                            clearForm();
                        }
                        else {
                            alert(d.Message);
                        }
                        $('#btnSubmit').val('@Resources.SaveButton');
                    },
                    error: function (response) {
                        alert('Error. Please try again.');
                        $('#btnSubmit').val('@Resources.SaveButton');
                    }
                });
            }
        });
    });
</script>

<style>
    /*Adding some css for looks good*/
    span.error {
        display: inline-block;
        visibility: hidden;
        color: red;
        font-size: 90%;
    }

    .ipt {
        margin-bottom: 6px;
    }
    fieldset {
        border: 1px solid #ddd !important;
        margin: 10px;
        min-width: 0;
        padding: 10px;
        position: relative;
        border-radius: 4px;
        background-color: #99bce8;
        padding-left: 10px !important;
    }
    .invalid-data { 
        border: 1px solid red; 
    }
    .valid-data
    { 
        border: 1px solid #ccc;
    }
</style>